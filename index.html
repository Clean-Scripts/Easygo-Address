<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyGo | Address & Delivery</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Address/refs/heads/main/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        @media (min-width: 1024px) {
            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
        }
        
        @media (max-width: 640px) {
            body {
                background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            }
        }
        
        .container-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .map-container {
            height: 300px;
            width: 100%;
            border-radius: 1rem;
            z-index: 1;
        }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .floating-label-group {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .floating-label {
            position: absolute;
            top: -10px;
            left: 12px;
            font-size: 12px;
            color: #3b82f6;
            background: white;
            padding: 0 5px;
            z-index: 10;
            opacity: 0;
            transition: all 0.2s ease;
        }
        
        .floating-input:focus + .floating-label,
        .floating-input:not(:placeholder-shown) + .floating-label {
            opacity: 1;
            transform: translateY(0);
        }
        
        .input-with-icon {
            padding-left: 3rem !important;
        }
        
        .step-indicator {
            position: relative;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .step-active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .step-completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .step-inactive {
            background-color: #e5e7eb;
            color: #6b7280;
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            transition: width 0.5s ease;
        }
        
        /* Card hover effects */
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        /* Button animations */
        .btn-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .container-card {
                margin: 0.5rem;
                padding: 1.5rem;
            }
            
            .map-container {
                height: 250px;
            }
            
            h1 {
                font-size: 1.875rem !important;
            }
            
            h2 {
                font-size: 1.5rem !important;
            }
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="min-h-screen py-4 md:py-8 px-3 md:px-4">
    
    <!-- Main Container -->
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="container-card rounded-2xl p-6 mb-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <!-- Logo and Brand -->
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 md:w-20 md:h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Address/refs/heads/main/logo.png" 
                             alt="EasyGo Logo" 
                             class="w-12 h-12 md:w-16 md:h-16 object-contain">
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">EasyGo Delivery</h1>
                        <p class="text-gray-600 text-sm md:text-base">Enter address & select delivery mode</p>
                    </div>
                </div>
                
                <!-- Cart Summary -->
                <div id="cart-summary-badge" class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl px-4 py-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-shopping-cart text-white"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-700 text-sm">Cart Total</p>
                            <p id="cart-total-badge" class="font-bold text-green-700 text-lg">‚Çπ0</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Progress Steps -->
            <div class="mt-8">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center">
                        <div class="step-indicator step-completed">
                            <i class="fas fa-check"></i>
                        </div>
                        <span class="font-medium text-green-600">Cart</span>
                    </div>
                    <div class="flex-1 mx-4">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 50%"></div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="step-indicator step-active">
                            2
                        </div>
                        <span class="font-medium text-blue-600">Address</span>
                    </div>
                    <div class="flex-1 mx-4">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="step-indicator step-inactive">
                            3
                        </div>
                        <span class="font-medium text-gray-500">Payment</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Column: Address Form -->
            <div class="space-y-6">
                <!-- Address Form Card -->
                <div class="container-card rounded-2xl p-6 card-hover">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-map-marker-alt text-blue-600 text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Delivery Address</h2>
                    </div>
                    
                    <!-- Delivery Mode Selection -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Select Delivery Mode</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div id="delivery-option" 
                                 class="border-2 border-blue-500 bg-blue-50 rounded-xl p-5 cursor-pointer transition-all duration-300 hover:bg-blue-100 active:scale-95"
                                 onclick="switchToDelivery()">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-motorcycle text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-gray-800">Home Delivery</p>
                                        <p class="text-sm text-blue-600 mt-1">Delivered to your address</p>
                                    </div>
                                </div>
                            </div>
                            <div id="takeaway-option" 
                                 class="border-2 border-gray-300 rounded-xl p-5 cursor-pointer transition-all duration-300 hover:border-green-500 hover:bg-green-50 active:scale-95"
                                 onclick="switchToTakeaway()">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center">
                                        <i class="fas fa-store text-gray-600 text-lg"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-gray-800">Takeaway</p>
                                        <p class="text-sm text-gray-600 mt-1">Pickup from Prime Square</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Takeaway Info -->
                    <div id="takeaway-info" class="hidden mb-6 p-5 bg-green-50 border-2 border-green-200 rounded-xl">
                        <div class="flex items-start gap-4">
                            <i class="fas fa-info-circle text-green-500 text-xl mt-1"></i>
                            <div>
                                <h4 class="font-bold text-green-800 mb-2">Takeaway Information</h4>
                                <ul class="space-y-2 text-green-700 text-sm">
                                    <li class="flex items-center gap-2">
                                        <i class="fas fa-map-marker-alt text-green-600"></i>
                                        <span><strong>Pickup Address:</strong> Prime Square, Omaxe City 1, Indore</span>
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i class="fas fa-clock text-green-600"></i>
                                        <span><strong>Timings:</strong> 6:00 PM - 10:00 PM</span>
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle text-green-600"></i>
                                        <span><strong>Note:</strong> Bring order confirmation for pickup</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Address Form -->
                    <form id="addressForm" class="space-y-5">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <!-- Name -->
                            <div class="md:col-span-2">
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <input type="text" 
                                           id="name" 
                                           required
                                           class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Full Name">
                                    <label class="floating-label">Full Name *</label>
                                </div>
                            </div>
                            
                            <!-- Phone Number -->
                            <div class="md:col-span-2">
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-phone"></i>
                                    </div>
                                    <input type="tel" 
                                           id="phone" 
                                           required
                                           pattern="[0-9]{10}"
                                           class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Phone Number">
                                    <label class="floating-label">Phone Number *</label>
                                </div>
                            </div>
                            
                            <!-- Address Type -->
                            <div>
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <select id="addressType" 
                                            required
                                            class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition appearance-none bg-white">
                                        <option value="" disabled selected>Select Address Type</option>
                                        <option value="Flat">üè¢ Flat</option>
                                        <option value="House">üè† House</option>
                                        <option value="Office">üíº Office</option>
                                        <option value="Hostel">üè´ Hostel</option>
                                        <option value="PG">üõèÔ∏è P.G.</option>
                                    </select>
                                    <label class="floating-label">Address Type *</label>
                                </div>
                            </div>
                            
                            <!-- House Number -->
                            <div>
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <input type="text" 
                                           id="houseNumber" 
                                           required
                                           class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="House/Flat No.">
                                    <label class="floating-label">House/Flat No. *</label>
                                </div>
                            </div>
                            
                            <!-- Floor Number -->
                            <div>
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-stairs"></i>
                                    </div>
                                    <input type="text" 
                                           id="floorNumber"
                                           class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Floor No.">
                                    <label class="floating-label">Floor No.</label>
                                </div>
                            </div>
                            
                            <!-- Locality -->
                            <div class="md:col-span-2">
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-location-dot"></i>
                                    </div>
                                    <input type="text" 
                                           id="locality" 
                                           required
                                           class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Locality">
                                    <label class="floating-label">Locality *</label>
                                </div>
                            </div>
                            
                            <!-- Street -->
                            <div class="md:col-span-2">
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-road"></i>
                                    </div>
                                    <input type="text" 
                                           id="street" 
                                           required
                                           class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Street Name">
                                    <label class="floating-label">Street Name *</label>
                                </div>
                            </div>
                            
                            <!-- Pincode -->
                            <div>
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-map-pin"></i>
                                    </div>
                                    <input type="text" 
                                           id="pincode" 
                                           required
                                           maxlength="6"
                                           pattern="[0-9]{6}"
                                           class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Pincode">
                                    <label class="floating-label">Pincode *</label>
                                </div>
                            </div>
                            
                            <!-- City -->
                            <div>
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-city"></i>
                                    </div>
                                    <input type="text" 
                                           id="city" 
                                           readonly
                                           class="w-full p-4 pl-12 border-2 border-gray-300 rounded-xl bg-gray-50 text-gray-600"
                                           placeholder="City">
                                    <label class="floating-label">City</label>
                                </div>
                            </div>
                            
                            <!-- State -->
                            <div class="md:col-span-2">
                                <div class="relative">
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-flag"></i>
                                    </div>
                                    <input type="text" 
                                           id="state" 
                                           readonly
                                           class="w-full p-4 pl-12 border-2 border-gray-300 rounded-xl bg-gray-50 text-gray-600"
                                           placeholder="State">
                                    <label class="floating-label">State</label>
                                </div>
                            </div>
                            
                            <!-- Special Request -->
                            <div class="md:col-span-2">
                                <div class="relative">
                                    <div class="absolute left-4 top-4 text-gray-400">
                                        <i class="fas fa-sticky-note"></i>
                                    </div>
                                    <textarea id="specialRequest"
                                              rows="3"
                                              class="floating-input w-full p-4 pl-12 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition resize-none"
                                              placeholder="Special Request (Optional)"></textarea>
                                    <label class="floating-label">Special Request</label>
                                </div>
                                <div class="mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <p class="text-sm text-yellow-700 flex items-start gap-2">
                                        <i class="fas fa-exclamation-triangle mt-1 text-yellow-500"></i>
                                        Please avoid unnecessary requests. Additional charges may apply for special requests.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Location Button Section -->
                <div id="location-section" class="container-card rounded-2xl p-6 card-hover">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Location Verification</h3>
                    <p class="text-gray-600 mb-6">Set your location for accurate delivery charge calculation.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="getLocationBtn" 
                                class="flex items-center justify-center gap-3 p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold rounded-xl hover:opacity-90 transition-all btn-pulse shadow-lg">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Set Your Location</span>
                        </button>
                        
                        <div class="flex gap-4">
                            <button id="useCurrentLocationBtn" 
                                    class="flex-1 flex items-center justify-center gap-2 p-4 bg-blue-50 border-2 border-blue-200 text-blue-700 rounded-xl hover:bg-blue-100 transition">
                                <i class="fas fa-location-crosshairs"></i>
                                <span class="font-medium">Auto</span>
                            </button>
                            
                            <button id="manualLocationBtn" 
                                    class="flex-1 flex items-center justify-center gap-2 p-4 bg-purple-50 border-2 border-purple-200 text-purple-700 rounded-xl hover:bg-purple-100 transition">
                                <i class="fas fa-map-pin"></i>
                                <span class="font-medium">Manual</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Location Status -->
                    <div id="locationStatus" class="mt-4 p-4 bg-green-50 border-2 border-green-200 rounded-xl hidden">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-check-circle text-2xl text-green-500"></i>
                                <div>
                                    <p class="font-bold text-green-700">Location Set</p>
                                    <p class="text-sm text-gray-600">Distance: <span id="previewDistance" class="font-bold">-- km</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Map and Summary -->
            <div class="space-y-6">
                <!-- Map Container -->
                <div id="map-section" class="container-card rounded-2xl p-6 card-hover">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-gray-800">Location Map</h2>
                        <div class="flex items-center gap-2 text-sm text-gray-600">
                            <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                            <span>Prime Square</span>
                            <div class="w-3 h-3 bg-purple-500 rounded-full ml-2"></div>
                            <span>Your Location</span>
                        </div>
                    </div>
                    
                    <div id="map" class="map-container"></div>
                    
                    <!-- Location Link -->
                    <div id="locationLinkContainer" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-xl hidden">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-link text-blue-500"></i>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm text-blue-800 mb-1">Location Link:</p>
                                <a id="locationLink" href="#" target="_blank" class="text-blue-600 text-sm truncate block hover:underline"></a>
                            </div>
                            <button id="copyLinkBtn" class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery Charges Card -->
                <div id="deliveryChargesCard" class="container-card rounded-2xl p-6 card-hover hidden">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-truck text-blue-600 text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Delivery Charges</h2>
                    </div>
                    
                    <!-- Distance Display -->
                    <div class="mb-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium text-gray-700">Distance from Prime Square</p>
                                <p class="text-sm text-gray-500">Your delivery location</p>
                            </div>
                            <span id="distanceValue" class="text-3xl font-bold text-blue-700">-- km</span>
                        </div>
                    </div>
                    
                    <!-- Charges Breakdown -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
                            <span class="font-medium text-gray-700">Base Fare</span>
                            <span id="baseFare" class="font-bold text-gray-800 text-xl">‚Çπ0</span>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
                            <span class="font-medium text-gray-700">GST (18%)</span>
                            <span id="gstValue" class="font-bold text-gray-800 text-xl">‚Çπ0</span>
                        </div>
                        
                        <!-- Total Delivery Charge -->
                        <div class="mt-6 p-5 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-bold text-gray-800">Total Delivery Charge</p>
                                    <p class="text-sm text-green-600">Inclusive of all taxes</p>
                                </div>
                                <span id="totalCharge" class="font-bold text-green-700 text-3xl">‚Çπ0</span>
                            </div>
                        </div>
                        
                        <!-- Free Delivery Offer -->
                        <div id="freeDeliveryOffer" class="p-4 bg-green-50 border-2 border-green-200 rounded-xl hidden">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-gift text-green-500 text-xl"></i>
                                <div>
                                    <p class="font-bold text-green-800">üéâ FREE DELIVERY!</p>
                                    <p class="text-sm text-green-700">Order above ‚Çπ199 qualifies for free delivery</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Range Warning -->
                        <div id="rangeWarning" class="p-4 bg-red-50 border-2 border-red-200 rounded-xl hidden">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                                <div>
                                    <p class="font-bold text-red-800">Beyond Delivery Range</p>
                                    <p class="text-sm text-red-700">Please select takeaway option</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button id="proceedToPaymentBtn" 
                                class="w-full flex items-center justify-center gap-3 p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:opacity-90 transition-all shadow-lg">
                            <i class="fas fa-check-circle"></i>
                            <span>Proceed to Payment</span>
                        </button>
                        
                        <a href="https://clean-scripts.github.io/Easygo-Cart/" 
                           class="w-full flex items-center justify-center gap-3 p-4 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition">
                            <i class="fas fa-arrow-left"></i>
                            <span>Back to Cart</span>
                        </a>
                    </div>
                </div>
                
                <!-- Takeaway Summary -->
                <div id="takeawaySummary" class="container-card rounded-2xl p-6 card-hover hidden">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-store text-green-600 text-xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Takeaway Summary</h2>
                    </div>
                    
                    <!-- Takeaway Info -->
                    <div class="mb-6 p-5 bg-green-50 border-2 border-green-200 rounded-xl">
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-map-marker-alt text-green-500"></i>
                                <div>
                                    <p class="font-medium text-gray-700">Pickup Location</p>
                                    <p class="text-green-700">Prime Square, Omaxe City 1, Indore</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <i class="fas fa-clock text-green-500"></i>
                                <div>
                                    <p class="font-medium text-gray-700">Pickup Timings</p>
                                    <p class="text-green-700">6:00 PM - 10:00 PM</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="space-y-4">
                        <button id="proceedToPaymentTakeawayBtn" 
                                class="w-full flex items-center justify-center gap-3 p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:opacity-90 transition-all shadow-lg">
                            <i class="fas fa-check-circle"></i>
                            <span>Proceed to Payment</span>
                        </button>
                        
                        <button id="switchToDeliveryBtn" 
                                class="w-full flex items-center justify-center gap-3 p-4 bg-blue-100 border-2 border-blue-200 text-blue-700 font-bold rounded-xl hover:bg-blue-200 transition">
                            <i class="fas fa-motorcycle"></i>
                            <span>Switch to Delivery</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-8 container-card rounded-2xl p-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-2">
                    <i class="fas fa-shield-alt text-blue-500"></i>
                    <span class="text-gray-600">Secure & Encrypted</span>
                </div>
                <div class="flex items-center gap-6">
                    <a href="https://wa.me/917651837322" target="_blank" 
                       class="flex items-center gap-2 text-green-600 hover:text-green-700 transition">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp Support</span>
                    </a>
                    <a href="https://clean-scripts.github.io/Easygo-Menu/" 
                       class="flex items-center gap-2 text-blue-600 hover:text-blue-700 transition">
                        <i class="fas fa-utensils"></i>
                        <span>View Menu</span>
                    </a>
                </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-200 text-center">
                <p class="text-sm text-gray-500">¬© 2024 EasyGo | Freshness & Speed Delivered</p>
            </div>
        </footer>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-xl font-bold text-gray-800 mb-2">Processing</p>
            <p class="text-gray-600">Verifying your location...</p>
        </div>
    </div>

    <script>
        // Global variables
        let map;
        let userMarker;
        let userLocation = null;
        let deliveryMode = 'delivery';
        let googleMapsLink = "";
        
        // Restaurant location
        const primeSquareLocation = [22.7767737, 75.9605483];
        
        // Initialize map
        function initMap(lat = primeSquareLocation[0], lng = primeSquareLocation[1]) {
            if (!map) {
                map = L.map('map').setView([lat, lng], 14);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap'
                }).addTo(map);
                
                // Add restaurant marker
                L.marker(primeSquareLocation).addTo(map)
                    .bindPopup('<b>Prime Square</b><br>EasyGo Restaurant')
                    .openPopup();
                    
                // Add delivery range circles
                L.circle(primeSquareLocation, {
                    color: '#3b82f6',
                    fillColor: '#3b82f6',
                    fillOpacity: 0.1,
                    radius: 4000
                }).addTo(map);
                
                L.circle(primeSquareLocation, {
                    color: '#f59e0b',
                    fillColor: '#f59e0b',
                    fillOpacity: 0.05,
                    radius: 10000
                }).addTo(map);
            }
        }
        
        // Calculate distance between coordinates
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Calculate delivery charges
        function calculateDeliveryCharges(distance) {
            const cartTotal = parseFloat(localStorage.getItem('easygo-cart-total')) || 0;
            const freeDeliveryEligible = cartTotal > 199;
            
            // Check if beyond range
            if (distance > 10) {
                return { beyondRange: true, distance: distance.toFixed(2) };
            }
            
            let baseCharge = 0;
            
            if (distance <= 4) {
                if (freeDeliveryEligible) {
                    baseCharge = 0;
                } else {
                    baseCharge = Math.ceil(distance * 2);
                }
            } else if (distance <= 10) {
                const extraKm = distance - 4;
                baseCharge = Math.ceil(4 * 2 + extraKm * 3);
            }
            
            const gst = baseCharge * 0.18;
            const totalCharge = baseCharge + gst;
            
            return {
                distance: distance.toFixed(2),
                baseCharge: baseCharge,
                gst: gst.toFixed(2),
                totalCharge: totalCharge.toFixed(2),
                freeDelivery: freeDeliveryEligible && distance <= 4,
                beyondRange: false
            };
        }
        
        // Generate Google Maps link
        function generateGoogleMapsLink(lat, lng) {
            return `https://www.google.com/maps?q=${lat},${lng}&z=17`;
        }
        
        // Update delivery charges display
        function updateDeliveryCharges() {
            if (!userLocation) return;
            
            const distance = calculateDistance(
                primeSquareLocation[0], primeSquareLocation[1],
                userLocation.lat, userLocation.lng
            );
            
            const charges = calculateDeliveryCharges(distance);
            
            if (charges.beyondRange) {
                document.getElementById('rangeWarning').classList.remove('hidden');
                document.getElementById('freeDeliveryOffer').classList.add('hidden');
                document.getElementById('proceedToPaymentBtn').disabled = true;
                document.getElementById('proceedToPaymentBtn').classList.add('opacity-50');
                return;
            }
            
            document.getElementById('rangeWarning').classList.add('hidden');
            document.getElementById('proceedToPaymentBtn').disabled = false;
            document.getElementById('proceedToPaymentBtn').classList.remove('opacity-50');
            
            // Update UI
            document.getElementById('distanceValue').textContent = `${charges.distance} km`;
            document.getElementById('previewDistance').textContent = `${charges.distance} km`;
            document.getElementById('baseFare').textContent = `‚Çπ${charges.baseCharge}`;
            document.getElementById('gstValue').textContent = `‚Çπ${charges.gst}`;
            document.getElementById('totalCharge').textContent = `‚Çπ${charges.totalCharge}`;
            
            if (charges.freeDelivery) {
                document.getElementById('freeDeliveryOffer').classList.remove('hidden');
            } else {
                document.getElementById('freeDeliveryOffer').classList.add('hidden');
            }
            
            // Generate location link
            googleMapsLink = generateGoogleMapsLink(userLocation.lat, userLocation.lng);
            document.getElementById('locationLink').textContent = googleMapsLink;
            document.getElementById('locationLink').href = googleMapsLink;
            document.getElementById('locationLinkContainer').classList.remove('hidden');
            document.getElementById('deliveryChargesCard').classList.remove('hidden');
            
            // Save delivery data
            const deliveryData = {
                mode: 'delivery',
                distance: charges.distance,
                charge: charges.totalCharge,
                location: userLocation,
                locationLink: googleMapsLink
            };
            localStorage.setItem('easygo-delivery', JSON.stringify(deliveryData));
        }
        
        // Set user location on map
        function setUserLocation(lat, lng) {
            userLocation = { lat, lng };
            
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            
            userMarker = L.marker([lat, lng], { draggable: true }).addTo(map);
            map.setView([lat, lng], 16);
            
            userMarker.on('dragend', function() {
                const position = userMarker.getLatLng();
                userLocation = { lat: position.lat, lng: position.lng };
                updateDeliveryCharges();
            });
            
            document.getElementById('locationStatus').classList.remove('hidden');
            updateDeliveryCharges();
            document.getElementById('loadingOverlay').classList.add('hidden');
        }
        
        // Get current location
        function getCurrentLocation() {
            if (!validateForm()) return;
            
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        setUserLocation(position.coords.latitude, position.coords.longitude);
                    },
                    () => {
                        document.getElementById('loadingOverlay').classList.add('hidden');
                        alert("Unable to get location. Please use manual pin drop.");
                    }
                );
            }
        }
        
        // Validate form
        function validateForm() {
            const requiredFields = ['name', 'phone', 'addressType', 'houseNumber', 'locality', 'street', 'pincode'];
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.classList.add('border-red-500');
                    field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    alert('Please fill all required fields');
                    return false;
                }
            }
            
            const phone = document.getElementById('phone').value;
            if (!/^\d{10}$/.test(phone)) {
                alert('Please enter valid 10-digit phone number');
                return false;
            }
            
            const pincode = document.getElementById('pincode').value;
            if (!/^\d{6}$/.test(pincode)) {
                alert('Please enter valid 6-digit pincode');
                return false;
            }
            
            // Save address
            const address = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                addressType: document.getElementById('addressType').value,
                houseNumber: document.getElementById('houseNumber').value,
                floorNumber: document.getElementById('floorNumber').value,
                locality: document.getElementById('locality').value,
                street: document.getElementById('street').value,
                pincode: document.getElementById('pincode').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                specialRequest: document.getElementById('specialRequest').value,
                deliveryMode: deliveryMode
            };
            localStorage.setItem('easygo-address', JSON.stringify(address));
            
            return true;
        }
        
        // Switch to delivery mode
        function switchToDelivery() {
            deliveryMode = 'delivery';
            document.getElementById('delivery-option').classList.add('border-blue-500', 'bg-blue-50');
            document.getElementById('delivery-option').classList.remove('border-gray-200');
            document.getElementById('takeaway-option').classList.add('border-gray-200');
            document.getElementById('takeaway-option').classList.remove('border-green-500', 'bg-green-50');
            
            document.getElementById('takeaway-info').classList.add('hidden');
            document.getElementById('takeawaySummary').classList.add('hidden');
            document.getElementById('map-section').classList.remove('hidden');
            document.getElementById('location-section').classList.remove('hidden');
            
            if (!map) initMap();
        }
        
        // Switch to takeaway mode
        function switchToTakeaway() {
            deliveryMode = 'takeaway';
            document.getElementById('takeaway-option').classList.add('border-green-500', 'bg-green-50');
            document.getElementById('takeaway-option').classList.remove('border-gray-200');
            document.getElementById('delivery-option').classList.add('border-gray-200');
            document.getElementById('delivery-option').classList.remove('border-blue-500', 'bg-blue-50');
            
            document.getElementById('takeaway-info').classList.remove('hidden');
            document.getElementById('map-section').classList.add('hidden');
            document.getElementById('location-section').classList.add('hidden');
            document.getElementById('deliveryChargesCard').classList.add('hidden');
            document.getElementById('takeawaySummary').classList.remove('hidden');
            
            // Auto-fill restaurant address
            document.getElementById('locality').value = 'Prime Square';
            document.getElementById('street').value = 'Omaxe City 1';
            document.getElementById('city').value = 'Indore';
            document.getElementById('state').value = 'Madhya Pradesh';
            document.getElementById('pincode').value = '452001';
            
            const takeawayData = {
                mode: 'takeaway',
                pickupLocation: 'Prime Square, Omaxe City 1, Indore',
                timings: '6:00 PM - 10:00 PM',
                charge: 0
            };
            localStorage.setItem('easygo-delivery', JSON.stringify(takeawayData));
        }
        
        // Load cart total
        function loadCartTotal() {
            const cartTotal = localStorage.getItem('easygo-cart-total') || '0';
            document.getElementById('cart-total-badge').textContent = `‚Çπ${cartTotal}`;
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadCartTotal();
            switchToDelivery();
            
            // Pincode lookup
            document.getElementById('pincode').addEventListener('input', function() {
                const pincode = this.value;
                if (pincode.length === 6) {
                    document.getElementById('city').value = "Indore";
                    document.getElementById('state').value = "Madhya Pradesh";
                }
            });
            
            // Event listeners
            document.getElementById('getLocationBtn').addEventListener('click', getCurrentLocation);
            document.getElementById('useCurrentLocationBtn').addEventListener('click', getCurrentLocation);
            
            document.getElementById('manualLocationBtn').addEventListener('click', function() {
                if (!validateForm()) return;
                alert('Click on the map to set your location');
                map.once('click', function(e) {
                    setUserLocation(e.latlng.lat, e.latlng.lng);
                });
            });
            
            // Copy location link
            document.getElementById('copyLinkBtn').addEventListener('click', function() {
                navigator.clipboard.writeText(googleMapsLink);
                this.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-copy"></i>';
                }, 2000);
            });
            
            // Proceed to payment
            document.getElementById('proceedToPaymentBtn').addEventListener('click', function() {
                if (!validateForm()) return;
                if (!userLocation) {
                    alert('Please set your location first');
                    return;
                }
                window.location.href = 'https://clean-scripts.github.io/Easygo-Payment/';
            });
            
            document.getElementById('proceedToPaymentTakeawayBtn').addEventListener('click', function() {
                if (!validateForm()) return;
                window.location.href = 'https://clean-scripts.github.io/Easygo-Payment/';
            });
            
            document.getElementById('switchToDeliveryBtn').addEventListener('click', switchToDelivery);
        });
    </script>
</body>
</html>

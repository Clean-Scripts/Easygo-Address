<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyGo-Address | Address Verification & Delivery Charges</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        .map-container {
            height: 300px;
            width: 100%;
            border-radius: 0.75rem;
            z-index: 1;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-gray-100 min-h-screen p-4 md:p-6">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
                <i class="fas fa-map-marker-alt text-blue-600 mr-2"></i>EasyGo-Address
            </h1>
            <p class="text-gray-600">Verify your address and calculate delivery charges instantly</p>
        </header>

        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Left Column: Address Form -->
            <div class="lg:w-1/2">
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 slide-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-address-card text-blue-600 mr-3"></i>Address Details
                    </h2>
                    
                    <!-- Offer Alert -->
                    <div class="mb-6 p-4 bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-xl">
                        <div class="flex items-start">
                            <i class="fas fa-gift text-green-600 text-xl mt-1 mr-3"></i>
                            <div>
                                <h3 class="font-bold text-green-800 mb-1">Special Offer Alert!</h3>
                                <p class="text-green-700">
                                    Orders within 4km from Prime Square, Omaxe City 1, Indore: 
                                    <span class="font-bold">Will be free if exceed costs: â‚¹199/-</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Address Form -->
                    <form id="addressForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Name -->
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-2 font-medium" for="name">
                                    <i class="fas fa-user text-blue-500 mr-2"></i>Full Name
                                </label>
                                <input type="text" id="name" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                       placeholder="Enter your full name">
                            </div>
                            
                            <!-- Phone Number -->
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-2 font-medium" for="phone">
                                    <i class="fas fa-phone text-blue-500 mr-2"></i>Phone Number
                                </label>
                                <input type="tel" id="phone" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                       placeholder="Enter your 10-digit phone number">
                            </div>
                            
                            <!-- Address Type -->
                            <div>
                                <label class="block text-gray-700 mb-2 font-medium" for="addressType">
                                    <i class="fas fa-home text-blue-500 mr-2"></i>Address Type
                                </label>
                                <select id="addressType" 
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                    <option value="Flat">Flat</option>
                                    <option value="House">House</option>
                                    <option value="Office">Office</option>
                                    <option value="PG">PG</option>
                                </select>
                            </div>
                            
                            <!-- Flat/House Number -->
                            <div>
                                <label class="block text-gray-700 mb-2 font-medium" for="houseNumber">
                                    <i class="fas fa-building text-blue-500 mr-2"></i>Flat/House/Office/PG Number
                                </label>
                                <input type="text" id="houseNumber" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                       placeholder="e.g., B-102">
                            </div>
                            
                            <!-- Floor Number -->
                            <div>
                                <label class="block text-gray-700 mb-2 font-medium" for="floorNumber">
                                    <i class="fas fa-stairs text-blue-500 mr-2"></i>Floor Number
                                </label>
                                <input type="text" id="floorNumber" 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                       placeholder="e.g., 2nd Floor">
                            </div>
                            
                            <!-- Locality -->
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-2 font-medium" for="locality">
                                    <i class="fas fa-location-dot text-blue-500 mr-2"></i>Locality
                                </label>
                                <input type="text" id="locality" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                       placeholder="Enter your locality">
                            </div>
                            
                            <!-- Street Name -->
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-2 font-medium" for="street">
                                    <i class="fas fa-road text-blue-500 mr-2"></i>Street Name
                                </label>
                                <input type="text" id="street" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                       placeholder="Enter street name">
                            </div>
                            
                            <!-- Pincode -->
                            <div>
                                <label class="block text-gray-700 mb-2 font-medium" for="pincode">
                                    <i class="fas fa-map-pin text-blue-500 mr-2"></i>Pincode
                                </label>
                                <input type="text" id="pincode" required maxlength="6"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                       placeholder="6-digit pincode">
                            </div>
                            
                            <!-- City (auto-filled) -->
                            <div>
                                <label class="block text-gray-700 mb-2 font-medium" for="city">
                                    <i class="fas fa-city text-blue-500 mr-2"></i>City
                                </label>
                                <input type="text" id="city" readonly
                                       class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50"
                                       placeholder="Will auto-fetch from pincode">
                            </div>
                            
                            <!-- State (auto-filled) -->
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-2 font-medium" for="state">
                                    <i class="fas fa-flag text-blue-500 mr-2"></i>State
                                </label>
                                <input type="text" id="state" readonly
                                       class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50"
                                       placeholder="Will auto-fetch from pincode">
                            </div>
                        </div>
                        
                        <!-- Location Button -->
                        <div class="mt-6">
                            <button type="button" id="getLocationBtn" 
                                    class="w-full flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 shadow-md hover:shadow-lg pulse">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Verify Location on Map</span>
                            </button>
                            <p class="text-sm text-gray-500 mt-2 text-center">
                                Click to mark your location on the map for accurate delivery charge calculation
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Right Column: Map and Charges -->
            <div class="lg:w-1/2">
                <!-- Map Container -->
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 slide-in">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-map text-blue-600 mr-3"></i>Location Verification
                    </h2>
                    
                    <div id="map" class="map-container"></div>
                    
                    <div class="mt-4 flex flex-col sm:flex-row gap-3">
                        <button id="useCurrentLocationBtn" 
                                class="flex-1 flex items-center justify-center gap-2 p-3 bg-blue-100 text-blue-700 font-medium rounded-lg hover:bg-blue-200 transition">
                            <i class="fas fa-location-crosshairs"></i>
                            <span>Use My Current Location</span>
                        </button>
                        <button id="manualLocationBtn" 
                                class="flex-1 flex items-center justify-center gap-2 p-3 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition">
                            <i class="fas fa-map-pin"></i>
                            <span>Drop Pin Manually</span>
                        </button>
                    </div>
                    
                    <div id="locationStatus" class="mt-4 p-3 rounded-lg hidden">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span id="locationText" class="text-green-700 font-medium">Location verified!</span>
                        </div>
                    </div>
                </div>
                
                <!-- Delivery Charges -->
                <div id="deliveryChargesCard" class="bg-white rounded-2xl shadow-xl p-6 slide-in hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-calculator text-blue-600 mr-3"></i>Delivery Charges
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                            <span class="font-medium text-gray-700">Distance from Prime Square</span>
                            <span id="distanceValue" class="font-bold text-blue-700">-- km</span>
                        </div>
                        
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">Base Fare</span>
                            <span id="baseFare" class="font-bold text-gray-800">â‚¹0</span>
                        </div>
                        
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">GST (18%)</span>
                            <span id="gstValue" class="font-bold text-gray-800">â‚¹0</span>
                        </div>
                        
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center p-3 bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg">
                                <span class="font-bold text-gray-800 text-lg">Total Delivery Charge</span>
                                <span id="totalCharge" class="font-bold text-green-700 text-2xl">â‚¹0</span>
                            </div>
                        </div>
                        
                        <div id="offerNote" class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg hidden">
                            <p class="text-sm text-yellow-800">
                                <i class="fas fa-info-circle mr-2"></i>
                                <span id="offerText"></span>
                            </p>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4 mt-6">
                            <button id="approveBtn" 
                                    class="flex-1 flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all duration-300 shadow-md hover:shadow-lg">
                                <i class="fas fa-check-circle"></i>
                                <span>Perfect! Pay & Deliver</span>
                            </button>
                            <button id="denyBtn" 
                                    class="flex-1 flex items-center justify-center gap-2 p-4 bg-gradient-to-r from-red-600 to-pink-600 text-white font-bold rounded-lg hover:from-red-700 hover:to-pink-700 transition-all duration-300 shadow-md hover:shadow-lg">
                                <i class="fas fa-times-circle"></i>
                                <span>Deny & Request Refund</span>
                            </button>
                        </div>
                        
                        <p class="text-xs text-gray-500 text-center mt-4">
                            <i class="fas fa-shield-alt mr-1"></i>Your data is secure. Details will be shared via WhatsApp for order confirmation.
                        </p>
                    </div>
                </div>
                
                <!-- Result Message -->
                <div id="resultMessage" class="hidden mt-6">
                    <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                        <div id="successMessage" class="hidden">
                            <div class="text-green-500 text-6xl mb-4">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">Item is Delivered!</h3>
                            <p class="text-gray-600 mb-4">Thank you for your order. Details have been shared via WhatsApp.</p>
                            <button id="newOrderBtn" class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-plus mr-2"></i>New Order
                            </button>
                        </div>
                        
                        <div id="deniedMessage" class="hidden">
                            <div class="text-red-500 text-6xl mb-4">
                                <i class="fas fa-sad-cry"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">We're Sorry to See you Go!</h3>
                            <p class="text-gray-600 mb-4">Your refund request has been noted. Details have been shared via WhatsApp.</p>
                            <button id="tryAgainBtn" class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-redo mr-2"></i>Try Again
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-8 text-center text-gray-500 text-sm">
            <p>EasyGo-Address | Delivery Charge Calculator | Hosted on GitHub</p>
            <p class="mt-1">WhatsApp Integration: +91 7651837322</p>
        </footer>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-lg font-medium text-gray-800">Calculating delivery charges...</p>
            <p class="text-gray-600 mt-2">Please wait a moment</p>
        </div>
    </div>
    
    <script>
        // Initialize map
        let map;
        let userMarker;
        let userLocation = null;
        const primeSquareLocation = [22.7533, 75.8937]; // Prime Square, Omaxe City 1, Indore
        const taskusLocation = [22.7176, 75.8582]; // Taskus, Indore
        const brilliantSapphireLocation = [22.7356, 75.8798]; // Brilliant Sapphire, Indore
        const ligSquareLocation = [22.7471, 75.8990]; // LIG Square, Indore
        
        // Pincode data (mock for demo - in production use an API)
        const pincodeData = {
            "452001": {city: "Indore", state: "Madhya Pradesh"},
            "452002": {city: "Indore", state: "Madhya Pradesh"},
            "452003": {city: "Indore", state: "Madhya Pradesh"},
            "452004": {city: "Indore", state: "Madhya Pradesh"},
            "452005": {city: "Indore", state: "Madhya Pradesh"},
            "452006": {city: "Indore", state: "Madhya Pradesh"},
            "452007": {city: "Indore", state: "Madhya Pradesh"},
            "452008": {city: "Indore", state: "Madhya Pradesh"},
            "452009": {city: "Indore", state: "Madhya Pradesh"},
            "452010": {city: "Indore", state: "Madhya Pradesh"},
            "452011": {city: "Indore", state: "Madhya Pradesh"},
            "452012": {city: "Indore", state: "Madhya Pradesh"},
            "452013": {city: "Indore", state: "Madhya Pradesh"},
            "452014": {city: "Indore", state: "Madhya Pradesh"},
            "452015": {city: "Indore", state: "Madhya Pradesh"},
            "452016": {city: "Indore", state: "Madhya Pradesh"}
        };
        
        // Initialize map
        function initMap(lat = primeSquareLocation[0], lng = primeSquareLocation[1]) {
            if (!map) {
                map = L.map('map').setView([lat, lng], 14);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                
                // Add reference markers
                L.marker(primeSquareLocation).addTo(map)
                    .bindPopup('<b>Prime Square, Omaxe City 1</b><br>Delivery reference point')
                    .openPopup();
                
                L.marker(taskusLocation).addTo(map)
                    .bindPopup('<b>Taskus, Indore</b>')
                    .openPopup();
                
                L.marker(brilliantSapphireLocation).addTo(map)
                    .bindPopup('<b>Brilliant Sapphire, Indore</b>')
                    .openPopup();
                    
                L.marker(ligSquareLocation).addTo(map)
                    .bindPopup('<b>LIG Square, Indore</b>')
                    .openPopup();
                    
                // Add a circle for 4km radius from Prime Square
                L.circle(primeSquareLocation, {
                    color: 'blue',
                    fillColor: '#3b82f6',
                    fillOpacity: 0.1,
                    radius: 4000 // 4km in meters
                }).addTo(map).bindPopup('4km free delivery zone from Prime Square');
            } else {
                map.setView([lat, lng], 14);
            }
        }
        
        // Calculate distance between two coordinates in km
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // Distance in km
        }
        
        // Calculate delivery charges based on distance
        function calculateDeliveryCharges(distance) {
            let baseCharge = 0;
            let offerText = "";
            let showOffer = false;
            
            // Parameter 1: Orders within 4km from Prime Square
            if (distance <= 4) {
                baseCharge = 0;
                offerText = "ðŸŽ‰ Free delivery! You're within 4km of Prime Square.";
                showOffer = true;
            } 
            // Parameter 2: Taskus and nearby 2km
            else if (calculateDistance(userLocation.lat, userLocation.lng, taskusLocation[0], taskusLocation[1]) <= 2) {
                baseCharge = 20;
                offerText = "Delivery to Taskus area: Fixed â‚¹20 charge";
            }
            // Parameter 3: Brilliant Sapphire and nearby 2km
            else if (calculateDistance(userLocation.lat, userLocation.lng, brilliantSapphireLocation[0], brilliantSapphireLocation[1]) <= 2) {
                baseCharge = 15;
                offerText = "Delivery to Brilliant Sapphire area: Fixed â‚¹15 charge";
            }
            // Parameter 4: From Prime Square to LIG Square and nearby 1km
            else if (distance <= calculateDistance(primeSquareLocation[0], primeSquareLocation[1], ligSquareLocation[0], ligSquareLocation[1]) + 1) {
                // â‚¹3 per 500m
                baseCharge = Math.ceil(distance * 2) * 3; // Convert km to 500m units
                offerText = "â‚¹3 per 500m charge applies for this route";
            }
            // Default: Beyond 4km from Prime Square but not in other zones
            else {
                baseCharge = 199; // Exceed cost
                offerText = "Beyond 4km from Prime Square: â‚¹199 charge applies";
            }
            
            // Apply GST
            const gst = baseCharge * 0.18;
            const totalCharge = baseCharge + gst;
            
            return {
                distance: distance.toFixed(2),
                baseCharge: baseCharge,
                gst: gst.toFixed(2),
                totalCharge: totalCharge.toFixed(2),
                offerText: offerText,
                showOffer: showOffer
            };
        }
        
        // Update delivery charges display
        function updateDeliveryCharges() {
            if (!userLocation) return;
            
            // Calculate distance from Prime Square
            const distance = calculateDistance(
                primeSquareLocation[0], primeSquareLocation[1],
                userLocation.lat, userLocation.lng
            );
            
            // Calculate charges
            const charges = calculateDeliveryCharges(distance);
            
            // Update UI
            document.getElementById('distanceValue').textContent = `${charges.distance} km`;
            document.getElementById('baseFare').textContent = `â‚¹${charges.baseCharge}`;
            document.getElementById('gstValue').textContent = `â‚¹${charges.gst}`;
            document.getElementById('totalCharge').textContent = `â‚¹${charges.totalCharge}`;
            
            // Show/hide offer note
            const offerNote = document.getElementById('offerNote');
            const offerText = document.getElementById('offerText');
            
            if (charges.showOffer) {
                offerText.textContent = charges.offerText;
                offerNote.classList.remove('hidden');
            } else {
                offerNote.classList.add('hidden');
            }
            
            // Show delivery charges card
            document.getElementById('deliveryChargesCard').classList.remove('hidden');
        }
        
        // Set user location on map
        function setUserLocation(lat, lng) {
            userLocation = { lat, lng };
            
            // Remove existing marker
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            
            // Add new marker
            userMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'custom-marker',
                    html: '<div class="pulse w-8 h-8 bg-blue-600 rounded-full border-4 border-white shadow-lg"></div>',
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                })
            }).addTo(map);
            
            // Center map on user location
            map.setView([lat, lng], 14);
            
            // Show location status
            const locationStatus = document.getElementById('locationStatus');
            const locationText = document.getElementById('locationText');
            locationText.textContent = `Location set: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
            locationStatus.classList.remove('hidden');
            locationStatus.classList.add('bg-green-50', 'border', 'border-green-200');
            
            // Update delivery charges
            updateDeliveryCharges();
            
            // Hide loading
            document.getElementById('loadingOverlay').classList.add('hidden');
        }
        
        // Get current location
        function getCurrentLocation() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        setUserLocation(lat, lng);
                    },
                    (error) => {
                        console.error("Error getting location:", error);
                        alert("Unable to get your location. Please allow location access or use manual pin drop.");
                        document.getElementById('loadingOverlay').classList.add('hidden');
                    }
                );
            } else {
                alert("Geolocation is not supported by this browser.");
                document.getElementById('loadingOverlay').classList.add('hidden');
            }
        }
        
        // Send data to WhatsApp
        function sendToWhatsApp(action) {
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const addressType = document.getElementById('addressType').value;
            const houseNumber = document.getElementById('houseNumber').value;
            const floorNumber = document.getElementById('floorNumber').value;
            const locality = document.getElementById('locality').value;
            const street = document.getElementById('street').value;
            const pincode = document.getElementById('pincode').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;
            
            const distance = document.getElementById('distanceValue').textContent;
            const totalCharge = document.getElementById('totalCharge').textContent;
            
            const message = `EasyGo-Address ${action}%0A%0A` +
                `*Name:* ${name}%0A` +
                `*Phone:* ${phone}%0A` +
                `*Address:* ${houseNumber}, ${floorNumber}, ${street}, ${locality}, ${city}, ${state} - ${pincode}%0A` +
                `*Address Type:* ${addressType}%0A` +
                `*Distance from Prime Square:* ${distance}%0A` +
                `*Total Delivery Charge:* ${totalCharge}%0A` +
                `*User Action:* ${action}`;
            
            // Open WhatsApp with pre-filled message
            window.open(`https://wa.me/917651837322?text=${message}`, '_blank');
        }
        
        // Reset form for new order
        function resetForm() {
            document.getElementById('resultMessage').classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('deniedMessage').classList.add('hidden');
            document.getElementById('deliveryChargesCard').classList.add('hidden');
            document.getElementById('locationStatus').classList.add('hidden');
            
            // Clear form (except for address type)
            document.getElementById('name').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('houseNumber').value = '';
            document.getElementById('floorNumber').value = '';
            document.getElementById('locality').value = '';
            document.getElementById('street').value = '';
            document.getElementById('pincode').value = '';
            document.getElementById('city').value = '';
            document.getElementById('state').value = '';
            
            // Reset map to default view
            initMap();
            
            // Remove user marker
            if (userMarker) {
                map.removeLayer(userMarker);
                userMarker = null;
                userLocation = null;
            }
        }
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize map
            initMap();
            
            // Pincode lookup
            document.getElementById('pincode').addEventListener('input', function() {
                const pincode = this.value;
                if (pincode.length === 6 && pincodeData[pincode]) {
                    document.getElementById('city').value = pincodeData[pincode].city;
                    document.getElementById('state').value = pincodeData[pincode].state;
                } else if (pincode.length === 6) {
                    // For demo purposes, set to Indore if pincode not in data
                    document.getElementById('city').value = "Indore";
                    document.getElementById('state').value = "Madhya Pradesh";
                }
            });
            
            // Get location button
            document.getElementById('getLocationBtn').addEventListener('click', function() {
                // Validate form first
                const requiredFields = ['name', 'phone', 'houseNumber', 'locality', 'street', 'pincode'];
                let isValid = true;
                
                requiredFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!field.value.trim()) {
                        field.classList.add('border-red-500');
                        isValid = false;
                    } else {
                        field.classList.remove('border-red-500');
                    }
                });
                
                if (!isValid) {
                    alert('Please fill in all required fields before verifying location.');
                    return;
                }
                
                getCurrentLocation();
            });
            
            // Use current location button
            document.getElementById('useCurrentLocationBtn').addEventListener('click', getCurrentLocation);
            
            // Manual location button
            document.getElementById('manualLocationBtn').addEventListener('click', function() {
                alert('Click on the map to drop a pin at your location.');
                
                // Set up map click listener
                map.once('click', function(e) {
                    setUserLocation(e.latlng.lat, e.latlng.lng);
                });
            });
            
            // Approve button
            document.getElementById('approveBtn').addEventListener('click', function() {
                document.getElementById('resultMessage').classList.remove('hidden');
                document.getElementById('successMessage').classList.remove('hidden');
                sendToWhatsApp('APPROVED - Order Confirmed');
            });
            
            // Deny button
            document.getElementById('denyBtn').addEventListener('click', function() {
                document.getElementById('resultMessage').classList.remove('hidden');
                document.getElementById('deniedMessage').classList.remove('hidden');
                sendToWhatsApp('DENIED - Refund Requested');
            });
            
            // New order button
            document.getElementById('newOrderBtn').addEventListener('click', resetForm);
            
            // Try again button
            document.getElementById('tryAgainBtn').addEventListener('click', resetForm);
            
            // Form validation styling
            const formInputs = document.querySelectorAll('#addressForm input, #addressForm select');
            formInputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value.trim() === '' && this.hasAttribute('required')) {
                        this.classList.add('border-red-500');
                    } else {
                        this.classList.remove('border-red-500');
                    }
                });
                
                input.addEventListener('input', function() {
                    if (this.value.trim() !== '') {
                        this.classList.remove('border-red-500');
                    }
                });
            });
        });
    </script>
</body>
</html>
